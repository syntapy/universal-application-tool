#! /bin/bash
# Note: Run `xhost +local:root` first to get this to work
#       Run `xhost -local:root` to undo
xhost +local:root
pushd $(git rev-parse --show-toplevel)

set -e
set +x

docker run --ipc=host --rm -it \
  -v "$(pwd)/browser-test/src:/usr/src/civiform-browser-tests/src" \
  -v "$(pwd)/browser-test/bin:/usr/src/civiform-browser-tests/bin" \
  -v "$(pwd)/browser-test/tmp:/usr/src/civiform-browser-tests/tmp" \
  -v /tmp/.X11-unix:/tmp/.X11-unix \
  -e DISPLAY=$DISPLAY \
  -p 6000:6000 \
  -h $HOSTNAME \
  -v $HOME/.Xauthority:$HOME/.Xauthority \
  --network browser-test_default \
  civiform-browser-test:latest \
  /usr/src/civiform-browser-tests/bin/wait_for_server_start_and_run_tests.sh \
  $@

popd
xhost -local:root
